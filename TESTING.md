# π§ ν”„λ΅μ νΈ ν…μ¤νΈ κ°€μ΄λ“

μ΄ λ¬Έμ„λ” `labnote-ai-backend` ν”„λ΅μ νΈμ ν’μ§μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ μ‘μ„±λ λ‹¤μ–‘ν• ν…μ¤νΈλ“¤μ„ μ‹¤ν–‰ν•κ³  κ΄€λ¦¬ν•λ” λ°©λ²•μ„ μ•λ‚΄ν•©λ‹λ‹¤. μλ™ν™”λ ν…μ¤νΈλ” μ½”λ“ λ³€κ²½ μ‹ λ°μƒν•  μ μλ” μ μ¬μ  λ¬Έμ λ¥Ό μ‚¬μ „μ— λ°κ²¬ν•κ³ , μ‹μ¤ν…μ μ•μ •μ„±μ„ μ μ§€ν•λ” λ° μ¤‘μ”ν• μ—­ν• μ„ ν•©λ‹λ‹¤.

## λ©μ°¨
1. ν…μ¤νΈ ν™κ²½ μ„¤μ •
2. μλ™ν™”λ λ‹¨μ„/ν†µν•© ν…μ¤νΈ μ‹¤ν–‰
3. ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ μΈ΅μ •
4. μλ™ E2E ν…μ¤νΈ: λ¦΄λ¦¬μ¤ μ›ν¬ν”λ΅μ°

---

## 1. ν…μ¤νΈ ν™κ²½ μ„¤μ •

ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•κΈ° μ„ν•΄ ν•„μ”ν• κ°λ°μ© μμ΅΄μ„± ν¨ν‚¤μ§€λ¥Ό μ„¤μΉν•΄μ•Ό ν•©λ‹λ‹¤.

1.  ν”„λ΅μ νΈμ Python κ°€μƒ ν™κ²½μ΄ ν™μ„±ν™”λμ–΄ μλ”μ§€ ν™•μΈν•©λ‹λ‹¤.

2.  μ•„λ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•μ—¬ `pytest`λ¥Ό ν¬ν•¨ν• ν…μ¤νΈ κ΄€λ ¨ ν¨ν‚¤μ§€λ“¤μ„ μ„¤μΉν•©λ‹λ‹¤.

    ```bash
    pip install -r requirements-dev.txt
    ```

    `requirements-dev.txt` νμΌμ—λ” λ‹¤μ ν¨ν‚¤μ§€λ“¤μ΄ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤:
    - `pytest`: Python ν…μ¤νΈ ν”„λ μ„μ›ν¬
    - `pytest-asyncio`: `asyncio` κΈ°λ° μ½”λ“λ¥Ό ν…μ¤νΈν•κΈ° μ„ν• ν”λ¬κ·ΈμΈ
    - `httpx`: FastAPI ν…μ¤νΈ ν΄λΌμ΄μ–ΈνΈκ°€ μ‚¬μ©ν•λ” HTTP ν΄λΌμ΄μ–ΈνΈ
    - `pytest-cov`: ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€λ¥Ό μΈ΅μ •ν•λ” ν”λ¬κ·ΈμΈ

---

## 2. μλ™ν™”λ λ‹¨μ„/ν†µν•© ν…μ¤νΈ μ‹¤ν–‰

ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬μ—μ„ μ•„λ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•μ—¬ λ¨λ“  μλ™ν™” ν…μ¤νΈλ¥Ό μν–‰ν•  μ μμµλ‹λ‹¤.

```bash
pytest -v
```

`-v` μµμ…μ€ κ° ν…μ¤νΈ μΌ€μ΄μ¤μ μ‹¤ν–‰ κ²°κ³Όλ¥Ό μƒμ„Έν•κ² λ³΄μ—¬μ¤λ‹λ‹¤. λ¨λ“  ν…μ¤νΈκ°€ `PASSED`λ΅ ν‘μ‹λλ©΄, ν•µμ‹¬ κΈ°λ¥λ“¤μ΄ μ •μƒμ μΌλ΅ μ‘λ™ν•¨μ„ μλ―Έν•©λ‹λ‹¤.

### ν…μ¤νΈ λ€μƒ νμΌ

ν„μ¬ ν…μ¤νΈ μ¤μ„νΈλ” `tests/` λ””λ ‰ν† λ¦¬ λ‚΄μ λ‹¤μ νμΌλ“¤λ΅ κµ¬μ„±λ©λ‹λ‹¤:

*   `tests/test_main_api.py`:
    *   FastAPIμ μ£Όμ” API μ—”λ“ν¬μΈνΈ(`/record_preference`, `/api/feedback_metrics` λ“±)μ λ™μ‘μ„ κ²€μ¦ν•©λ‹λ‹¤.
    *   μ‚¬μ©μ ν”Όλ“λ°±μ΄ λ°μ΄ν„°λ² μ΄μ¤μ— μ¬λ°”λ¥΄κ² μ €μ¥λλ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    *   λ‚ μ§ κΈ°λ° ν•„ν„°λ§ κΈ°λ¥μ μ •ν™•μ„±μ„ ν…μ¤νΈν•©λ‹λ‹¤.

*   `tests/test_dpo_git_push.py`:
    *   `/record_preference` API νΈμ¶ μ‹, DPO λ°μ΄ν„°λ¥Ό Git λ¦¬ν¬μ§€ν† λ¦¬λ΅ ν‘Έμ‹ν•λ” λ΅μ§μ„ κ²€μ¦ν•©λ‹λ‹¤.
    *   μ‹¤μ  Git λ…λ Ήμ„ μ‹¤ν–‰ν•λ” λ€μ‹ , κ΄€λ ¨ ν•¨μλ“¤μ΄ μ¬λ°”λ¥Έ μμ„μ™€ μΈμλ΅ νΈμ¶λλ”μ§€ **λ¨ν‚Ή(mocking)**μ„ ν†µν•΄ ν™•μΈν•©λ‹λ‹¤.

*   `tests/test_evaluate_model.py`:
    *   `scripts/evaluate_model.py`μ λ¨λΈ ν‰κ°€ νμ΄ν”„λΌμΈ μ „μ²΄ λ΅μ§μ„ κ²€μ¦ν•©λ‹λ‹¤.
    *   LLM API νΈμ¶μ„ λ¨ν‚Ήν•μ—¬, ν‰κ°€ κ²°κ³Όκ°€ λ΅κ·Έ νμΌκ³Ό λ°μ΄ν„°λ² μ΄μ¤μ— μ •ν™•ν κΈ°λ΅λλ”μ§€ ν…μ¤νΈν•©λ‹λ‹¤.

---

## 3. ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€ μΈ΅μ •

ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€λ” μ‘μ„±λ ν…μ¤νΈ μ½”λ“κ°€ μ‹¤μ  μ΄μ μ½”λ“μ λ‡ νΌμ„ΌνΈλ¥Ό μ‹¤ν–‰ν•λ”μ§€ λ‚νƒ€λ‚΄λ” μ§€ν‘μ…λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ ν…μ¤νΈκ°€ λ„λ½λ λ¶€λ¶„μ„ νμ•…ν•  μ μμµλ‹λ‹¤.

1.  **ν„°λ―Έλ„μ—μ„ μ»¤λ²„λ¦¬μ§€ λ¦¬ν¬νΈ ν™•μΈ**:

    μ•„λ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•λ©΄ `main.py`μ™€ `scripts/` λ””λ ‰ν† λ¦¬ λ‚΄ νμΌλ“¤μ— λ€ν• ν…μ¤νΈ μ»¤λ²„λ¦¬μ§€λ¥Ό μΈ΅μ •ν•κ³ , ν…μ¤νΈλμ§€ μ•μ€ μ½”λ“ λΌμΈμ„ ν„°λ―Έλ„μ— μ§μ ‘ ν‘μ‹ν•΄ μ¤λ‹λ‹¤.

    ```bash
    pytest --cov=main --cov=scripts --cov-report term-missing
    ```

2.  **HTML λ¦¬ν¬νΈ μƒμ„±**:

    λ” μ‹κ°μ μ΄κ³  μƒμ„Έν• λ¶„μ„μ„ μ„ν•΄ HTML ν•μ‹μ λ¦¬ν¬νΈλ¥Ό μƒμ„±ν•  μ μμµλ‹λ‹¤.

    ```bash
    pytest --cov=main --cov=scripts --cov-report html
    ```

    λ…λ Ή μ‹¤ν–‰ ν›„, ν”„λ΅μ νΈ λ£¨νΈμ— `htmlcov/` λ””λ ‰ν† λ¦¬κ°€ μƒμ„±λ©λ‹λ‹¤. `htmlcov/index.html` νμΌμ„ μ›Ή λΈλΌμ°μ €λ΅ μ—΄λ©΄ νμΌλ³„ μ»¤λ²„λ¦¬μ§€ ν„ν™©κ³Ό ν…μ¤νΈλμ§€ μ•μ€ μ½”λ“ λΌμΈμ„ μ‹κ°μ μΌλ΅ ν™•μΈν•  μ μμµλ‹λ‹¤.

---

## 4. μλ™ E2E ν…μ¤νΈ: λ¦΄λ¦¬μ¤ μ›ν¬ν”λ΅μ°

GitHub Actionsλ¥Ό μ΄μ©ν• μλ™ λ²„μ „ κ΄€λ¦¬ λ° λ¦΄λ¦¬μ¤ κΈ°λ¥μ€ μ‹¤μ  GitHub ν™κ²½μ—μ„ ν…μ¤νΈν•΄μ•Ό ν•©λ‹λ‹¤.

1.  **ν…μ¤νΈ λΈλμΉ μƒμ„±**:
    `main` λΈλμΉμ—μ„ μƒλ΅μ΄ ν…μ¤νΈμ© λΈλμΉλ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    ```bash
    git checkout -b feature/test-release-workflow
    ```

2.  **μ½”λ“ μμ • λ° μ»¤λ°‹**:
    κ°„λ‹¨ν• μ½”λ“ μμ •(μ: μ£Όμ„ μ¶”κ°€) ν›„, **Conventional Commits** ν•μ‹μ— λ§λ” μ»¤λ°‹ λ©”μ‹μ§€λ΅ μ»¤λ°‹ν•©λ‹λ‹¤.
    *   **Patch λ²„μ „ μƒμΉ ν…μ¤νΈ**: `git commit -m "fix: A small bug in documentation"`
    *   **Minor λ²„μ „ μƒμΉ ν…μ¤νΈ**: `git commit -m "feat: Add a new comment to a file"`

3.  **Pull Request λ° λ³‘ν•©**:
    - ν…μ¤νΈ λΈλμΉλ¥Ό GitHubμ— ν‘Έμ‹ν•©λ‹λ‹¤: `git push origin feature/test-release-workflow`
    - GitHub μ›Ήμ‚¬μ΄νΈμ—μ„ `main` λΈλμΉλ¥Ό λ€μƒμΌλ΅ Pull Request(PR)λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    - PRμ΄ `main` λΈλμΉμ— λ³‘ν•©(Merge)λλ„λ΅ ν•©λ‹λ‹¤.

4.  **κ²°κ³Ό ν™•μΈ**:
    - **Actions νƒ­**: λ¦¬ν¬μ§€ν† λ¦¬μ `Actions` νƒ­μΌλ΅ μ΄λ™ν•μ—¬ `Release and Publish` μ›ν¬ν”λ΅μ°κ°€ μ„±κ³µμ μΌλ΅ μ‹¤ν–‰λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.
    - **Releases νƒ­**: `Releases` νƒ­μ—μ„ μ»¤λ°‹ λ©”μ‹μ§€μ— λ”°λΌ λ²„μ „μ΄ μ¬λ°”λ¥΄κ² μƒμΉν–λ”μ§€(μ: `v2.5.0` -> `v2.5.1`), κ·Έλ¦¬κ³  ν•΄λ‹Ή λ²„μ „μ λ¦΄λ¦¬μ¤μ™€ νƒκ·Έκ°€ `CHANGELOG.md` λ‚΄μ©κ³Ό ν•¨κ» μƒμ„±λμ—λ”μ§€ ν™•μΈν•©λ‹λ‹¤.